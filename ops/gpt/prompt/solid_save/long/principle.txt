# 项目开发原则与方法论

## 核心原则

### 1. 4 层边界判定标准
每写一个函数/模块，问以下问题定位层级：

1. **它是否有 I/O？** (DB/HTTP/env/clock/random/print/metrics)
   - 是 → Adapter/Platform
   - 否 → 继续

2. **它是否表达业务规则/产品策略？**
   - 是 → Domain rules
   - 否 → 继续

3. **它是否在串流程？** (先做A再做B，失败走C)
   - 是 → Usecase
   - 否 → 继续

4. **它是否是"对外部能力的需求声明"？** (接口)
   - 是 → Port
   - 否 → 继续

5. **它是否跨多个业务能力复用且已出现≥3次？**
   - 是 → Shared（或 Platform）
   - 否 → 留在 feature 内

6. **它的变化频率是否很高？**
   - 高频变化 → 尽量下沉到 rules（可测、改动风险小）
   - 低频变化但影响大 → 用例层集中控制

## 开发公约

1. **规则层不准 I/O**；适配器层不准业务 if/else
2. **任何会改变上下文结构的改动**，都必须更新 schema + 黄金测试
3. **新增代码默认放 feature 内**；复用到第三次再上移到 shared/platform
4. **用例文件负责流程**，不负责细节算法；细节算法必须在 rules

## 质量保障

### Schema Gate (结构闸门)
- 在 usecase 的入口/出口做 schema 校验
- 关键数据结构: OpenAIMessage, ChatSession, STContextData

### Golden Test (黄金测试)
- 关键规则必须有锁定行为的测试
- 示例: `streamingSchedule.golden.ts`

