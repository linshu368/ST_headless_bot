# 功能规格说明 (Functional Spec)

## 已实现功能

### 1. 基础对话 (Chat)
- 支持用户发送文本消息
- Bot 以加载的角色身份回复
- 流式回复，打字机效果

### 2. 角色加载 (Character Loading)
- 支持 V2 格式 JSON 角色卡
- 自动提取系统提示词
- 支持 first_mes 作为开场白

### 3. 上下文记忆 (Context)
- 多轮对话支持
- OpenAI 格式历史记录管理
- 自动注入历史到 ST 引擎

### 4. 会话管理 (Session)
- 基于 userId 的会话隔离
- 30 分钟超时自动清理
- `/reset` 指令手动重置

### 5. 网络代理 (Proxy)
- 支持 SOCKS5 代理
- 环境变量配置

## 待实现功能

### P1 - 高优先级
- [ ] 角色切换指令 `/char <name>`
- [ ] 多角色列表查询 `/chars`


### P2 - 中优先级
- [ ] 模型等级切换支持
- [ ] 指令增强 支持
- [ ] 支付系统支持


## 技术约束

### 消息限制
- Telegram 消息最大 4096 字符
- 超长回复需要分段发送

### API 限制
- Telegram Bot API 速率限制
- LLM API Token 限制


